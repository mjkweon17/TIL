## 23년 11월 23일 ~ 23년 11월 27일

AWS EC2관련

1. EC2
    - 테넌시(Tennancy)
        - 인스턴스가 물리적 서버에 어떻게 배치되는지를 결정하는 옵션
        - 공유 테넌시(default tenency): 여러 사용자의 인스턴스가 하나의 물리적 서버에 함께 배치됨. 이 옵션은 비용 효율적임
        - 전용 테넌시(Dedicated Tenancy): 사용자의 인스턴스가 전용 물리적 서버에 배치됩니다. 이 옵션은 보안성이 높으나 비용이 더 많이 듬
        - 호스트 테넌시(Host Tenancy): 사용자가 전체 물리적 서버를 제어하며, 이 서버에 인스턴스를 배치할 수 있음. 이 옵션은 최고 수준의 제어력을 제공하지만, 비용이 가장 많이 듦
    - 인스턴스 수 결정 고려 사항
        - 트래픽 예상: 소프트웨어를 사용할 사용자의 수와 이들이 생성할 트래픽을 예상해야 함. 예상 트래픽이 많다면, 그만큼 더 많은 인스턴스가 필요할 수 있음.
        - 성능 요구사항: 소프트웨어가 높은 성능을 요구하는지, 그렇지 않은지에 따라 필요한 인스턴스의 수가 달라짐. 예를 들어, 데이터 집약적인 작업을 수행하는 소프트웨어는 더 많은 인스턴스가 필요할 수 있음
        - 확장성: 트래픽이 증가하거나, 서비스가 확장될 경우를 대비해서 확장성을 고려해야 함. 이 경우, 오토 스케일링 같은 기능을 사용하여 자동으로 인스턴스 수를 조절할 수 있음.
        - 비용: EC2 인스턴스는 비용이 발생하므로, 예산 내에서 최적의 성능을 낼 수 있는 인스턴스 수를 결정해야 함.
        - 이러한 요소들을 고려하여, 테스트와 모니터링을 통해 가장 효과적인 인스턴스 수를 결정할 수 있음. 처음부터 완벽하게 결정하는 것은 어렵기 때문에, 지속적인 모니터링과 조정을 통해 최적의 수를 찾아가는 것이 중요
    - 인스턴스 유형과 개수를 결정하기 위한 트래픽 부하 테스트 과정
        - 트래픽을 생성할 수 있는 도구를 선택
        - 테스트 환경을 설정하고 트래픽 부하를 생성
        - 인스턴스의 성능을 모니터링하고 기록. AWS에서는 CloudWatch라는 서비스를 제공하여 이를 쉽게 할 수 있음.
        - 테스트 결과를 분석하여 인스턴스가 트래픽을 얼마나 잘 처리하는지 결정
    - t3.medium
        - 가격 대비 훌륭한 성능을 제공. 작은 규모의 일반적인 워크로드에 적합하며, 많은 사용자들이 비용 효율적인 선택으로 인식하고 있음
        - 버스트 성능: T3 인스턴스는 CPU 사용량이 일정 수준 이하로 유지될 때 CPU 크레딧을 쌓음. 이 크레딧은 CPU 사용량이 증가할 때 추가적인 CPU 성능을 제공하는데 사용됨. 이런 특성으로 인해, 피크 사용 시간에 고성능을 보장할 수 있음
        - 범용 사용: t3.medium 인스턴스는 2 vCPU와 4GB의 메모리를 제공함. 이는 중소규모의 데이터베이스, 개발 환경, 테스트 환경, 백엔드 서버 등 다양한 애플리케이션에 적합한 사양.
        - 확장성: AWS를 사용하면 필요에 따라 쉽게 인스턴스 유형을 변경할 수 있음. 따라서 많은 사용자들이 시작점으로 t3.medium을 선택하고, 필요에 따라 인스턴스를 업그레이드함.
    - 인스턴스 범주
        - 일반 용도(General purpose): 이 범주의 인스턴스는 균형 잡힌 CPU, 메모리, 네트워크 리소스를 제공. 웹 서버, 개발 환경, 중소규모 데이터베이스 등 다양한 애플리케이션이 이 범주에 해당. 예를 들어, A1, T2, T3, T3a, T4g, M5, M5a, M5n, M6g, M6i 등이 있음.
        - 컴퓨트 최적화(Compute optimized): 이 범주의 인스턴스는 고성능 프로세서를 활용해 높은 컴퓨트 성능을 제공. 배치 처리 작업, 미디어 변환, 고성능 웹 서버, 고성능 컴퓨팅(HPC), 과학적 모델링, 머신 러닝 등의 애플리케이션에 적합. 예를 들어, C4, C5, C5a, C5n, C6g, C6gn, C6i 등이 있음.
        - 메모리 최적화(Memory optimized): 이 범주의 인스턴스는 메모리 집약적인 애플리케이션에 적합하게 많은 메모리를 제공. 대규모 데이터베이스, 메모리 캐싱 서비스, 실시간 빅 데이터 분석 등에 적합. 예를 들어, R4, R5, R5a, R5b, R6g, X1, X1e, z1d 등이 있음.
        - 스토리지 최적화(Storage optimized): 이 범주의 인스턴스는 고성능 로컬 스토리지를 제공. NoSQL 데이터베이스, 데이터 웨어하우스, 분산 파일 시스템 등의 워크로드에 적합. 예를 들어, D2, H1, I3, I3en 등이 있음.
        - GPU 인스턴스(GPU instances): 이 범주의 인스턴스는 GPU를 포함하고 있어, 그래픽 처리나 일반적인 GPGPU(General-Purpose computing on Graphics Processing Units) 작업에 적합. 머신 러닝, 고성능 컴퓨팅, 3D 그래픽 애플리케이션 등에 적합. 예를 들어, P2, P3, P4, G3, G4dn 등이 있음.
        - ARM 인스턴스(ARM instances): 이 범주의 인스턴스는 ARM 프로세서를 사용. 이는 비용 효율적인 컴퓨팅 성능을 제공. 예를 들어, A1, M6g, C6g, R6g 등이 있음.
    - 규모
        - 중소 규모
            - 중소 규모: 중소 규모의 애플리케이션은 일반적으로 수천에서 수만 명의 사용자를 대상으로 하며, 일반적으로 한 번에 처리해야 하는 트래픽 또는 데이터의 양이 제한적. 이러한 시스템은 일반적으로 한 개 또는 소수의 서버로 운영되며, 데이터베이스와 웹 서버 등의 기본적인 구성 요소만을 포함할 수 있음.
        - 대규모
            - 대규모: 대규모의 애플리케이션은 수백만, 수천만 또는 그 이상의 사용자를 대상으로 함. 이러한 시스템은 엄청난 양의 트래픽과 데이터를 처리해야 하며, 종종 분산 아키텍처와 여러 데이터 센터에 걸쳐 배포됨. 대규모 애플리케이션은 종종 복잡한 미들웨어, 다양한 데이터베이스 시스템, 크기가 큰 스토리지 시스템, 고급 보안 요구 사항 등 복잡한 요소를 포함하고 있음.
    - vCPU
        - 서버의 처리 능력과 성능에 중요한 역할을 함
        - 하나의 물리적 CPU 코어를 여러 가상의 CPU로 나눠 사용할 수 있게 하는 기술
        - 여러 작업을 동시에 처리하거나, 병렬처리가 가능한 작업을 빠르게 진행하는 데 필요한 자원
        - 웹 서버의 경우 동시에 많은 요청을 처리해야 하므로 vCPU의 개수가 많을수록 더 많은 요청을 동시에 처리할 수 있음
        - 그러나 이것이 항상 2개의 vCPU가 1개의 vCPU보다 더 좋다는 것을 의미하지는 않음. 애플리케이션이 병렬 처리를 활용하지 못하는 경우, 추가적인 vCPU는 큰 도움이 되지 않을 수 있음
    - 네트워크 성능
        - 인스턴스간의 통신 속도, 인스턴스와 AWS 서비스 간의 통신 속도, 인스턴스와 인터넷 간의 통신 속도에 영향을 미침
        - AWS는 Enhanced Networking 기능을 제공하여, 높은 네트워크 성능이 필요한 워크로드에 대해 더 낮은 지연시간과 더 높은 패킷 전송 속도를 제공
    - 스토리지ㅣ
        - 인스턴스 스토리지(Instance Store): 인스턴스 스토리지는 물리적으로 인스턴스에 직접 연결된 임시 스토리지. 이는 인스턴스가 실행되는 동안에만 데이터를 유지하며, 인스턴스가 중지되거나 종료되면 데이터는 사라짐. 디스크 I/O 성능이 뛰어나며 지연 시간이 매우 짧음. 인스턴스 스토리지는 고성능 애플리케이션, 임시 데이터, 캐시 등에 적합함.
        - EBS(Elastic Block Store): EBS는 인스턴스에 연결되어 사용할 수 있는 영구적인 블록 스토리지. EBS 볼륨은 EC2 인스턴스와 독립적으로 유지되므로, 인스턴스가 중지되거나 종료되도 데이터를 유지할 수 있음. EBS는 데이터베이스, 파일 시스템, 애플리케이션 등에 적합합니다.
    - 서비스 확장 방법
        - 수직 확장(Scaling Up): 인스턴스 유형을 변경하여 더 많은 CPU, 메모리, 네트워크 대역폭 등을 가진 인스턴스로 바꾸는 것. 예를 들어, t3.medium 인스턴스에서 m5.large와 같은 더 높은 사양의 인스턴스로 변경하는 것. 이 방법은 단순하고 빠르지만, 한계가 있음. 각 인스턴스 유형은 특정 사양까지만 제공하므로, 이를 넘어서는 확장이 필요하면 다른 방법을 사용해야 함.
        - 수평 확장(Scaling Out): 동일한 인스턴스를 여러 개 실행하여 트래픽을 분산하는 것. AWS의 로드 밸런서를 사용하여 인바운드 트래픽을 여러 인스턴스에 분산시키고, Auto Scaling 그룹을 사용하여 트래픽의 변화에 따라 자동으로 인스턴스의 수를 조절할 수 있음. 이 방법은 더 큰 확장성을 제공하며, 인스턴스의 장애에 대한 내성도 향상시킴.
    - 확장 방법을 선택할 때 고려해야 할 여러 요소
        - 워크로드의 요구사항과 예상 트래픽 패턴
            - 비정상적인 트래픽 증가: 예를 들어, 특정 이벤트로 인해 사용자가 갑자기 많이 증가하는 경우, 수평 확장(Scaling Out)이 더 적합할 수 있음. Auto Scaling 그룹을 사용하면, 트래픽이 증가하면 자동으로 인스턴스를 추가하고, 트래픽이 감소하면 인스턴스를 제거하여 리소스를 효율적으로 사용할 수 있음.
            - 고정된 트래픽: 일정한 수준의 트래픽이 유지되는 경우, 수직 확장(Scaling Up)이 더 적합할 수 있음. 한 번의 확장으로 서비스의 용량을 증가시킬 수 있으며, 관리가 상대적으로 간단함.
        - 비용, 성능, 관리 복잡성
            - 비용: 수평 확장은 인스턴스의 수를 늘리는 방식이므로, 비용이 선형적으로 증가합니다. 반면에, 수직 확장은 보통 더 큰 인스턴스 유형이 상대적으로 저렴한 경우가 많으므로, 비용 효율이 더 좋을 수 있음.
            - 성능: 수평 확장은 로드 밸런싱과 Auto Scaling을 사용하여 트래픽을 효과적으로 분산시키므로, 높은 트래픽에 대한 성능을 유지하는 데 유리. 반면에, 수직 확장은 단일 인스턴스의 성능을 향상시키므로, 인스턴스 당 성능이 중요한 워크로드에 유리.
            - 관리 복잡성: 수직 확장은 단순히 인스턴스 유형을 변경하는 것이므로, 관리가 상대적으로 간단. 반면에, 수평 확장은 로드 밸런서와 Auto Scaling 그룹을 설정하고 관리해야 하므로, 관리가 더 복잡할 수 있음.




- 스케일링 아웃
- 인스턴스 수를 늘리면 해당 인스턴스에도 서버를 또 배포해야 하는가?
- 로드 밸런서를 연결하는 법은?

t3.medium 하나로 fastapi 서버를 배포해서 사용하고 있다가 사용자가 증가해서 트래픽이 많아졌어. 그러면 


이 두 가지 방법은 각각의 장단점이 있으므로, 워크로드의 요구 사항과 예상 트래픽 패턴에 따라 적절한 방법을 선택해야 합니다. 또한, 비용, 성능, 관리 복잡성 등을 고려해야 합니다.



2. 서버 성능 테스트
    - 스트레스 테스팅, 트래픽 부하 테스트
    - 부하 테스트 도구
        - Apache Jmeter
        - SoapUI
        - Locust
    - Locust
        - Python으로 테스트 코드를 작성한다.
        - 빠르게 테스트 환경을 구축하고 실행해볼 수 있다.
    - https://medium.com/@jspark141515/locust%EB%A1%9C-%EC%84%9C%EB%B2%84-%EC%84%B1%EB%8A%A5-%ED%85%8C%EC%8A%A4%ED%8A%B8%ED%95%98%EA%B8%B0-7490d882015
    - https://viassh.github.io/project/concept-of-loadtest/
    - http://www.chlux.co.kr/bbs/board.php?bo_table=board02&wr_id=144&sca=Middleware&page=2
3. FastAPI와 병렬처리
    - FastAPI는 비동기 프로그래밍과 병렬 처리를 지원함
    - 내부적으로 Starlette를 사용하여 비동기 요청을 처리하고, Pydantic을 사용하여 데이터 검증과 직렬화를 수행
    - FPython의 비동기 함수(async/await 문법)를 사용하여 동시에 여러 요청을 처리할 수 있음. 이는 FastAPI 애플리케이션에 동시에 여러 클라이언트가 접속할 때, 각각의 요청을 독립적으로 처리할 수 있음을 의미.
    - 그러나 Python의 병렬 처리에 대한 지원은 GIL(Global Interpreter Lock) 때문에 제한적. GIL은 한 번에 하나의 스레드만 실행할 수 있도록 Python 인터프리터에 잠금을 거는 메커니즘이므로, 본질적으로 CPU-bound 작업에 대한 병렬 처리를 제한함.
    - 따라서 FastAPI는 I/O-bound 작업(예: HTTP 요청, 데이터베이스 쿼리 등)에 대한 병렬 처리를 활용하며, CPU-bound 작업(예: 복잡한 계산)에 대한 병렬 처리는 제한적.
    - CPU-bound 작업에 대한 병렬 처리가 필요한 경우, 다중 프로세스를 사용하거나, 비동기 작업을 처리할 수 있는 다른 도구를 사용하는 것이 좋음.
3. 로드 밸런싱과 오토 스케일링
    - 클라우드 컴퓨팅에서 중요한 개념이며, 웹 서비스의 확장성과 가용성을 향상시키는데 사용됨.
    - 로드 밸런싱 (Load Balancing): 로드 밸런서는 들어오는 네트워크 트래픽을 여러 서버에 분산시키는 역할을 함. 이렇게 하면, 단일 서버에 과부하가 걸리는 것을 방지하고, 여러 서버를 효율적으로 활용할 수 있음. 주로 사용되는 AWS의 로드 밸런서에는 Application Load Balancer(ALB), Network Load Balancer(NLB), Classic Load Balancer(CLB) 등이 있음.
    - 오토 스케일링 (Auto Scaling): 오토 스케일링은 서비스의 트래픽이 증가하거나 감소함에 따라 자동으로 서버의 수를 조절하는 기능. AWS에서는 Auto Scaling 그룹을 통해 이를 구현할 수 있음. Auto Scaling 그룹은 사용자가 설정한 정책에 따라 EC2 인스턴스의 수를 자동으로 늘리거나 줄이는 역할을 합니다. 예를 들어, CPU 사용률이 특정 임계값을 초과하면 인스턴스를 추가하고, CPU 사용률이 감소하면 인스턴스를 제거하는 등의 정책을 설정할 수 있음. 이렇게 하면, 트래픽 변동에 따라 자동으로 리소스를 조절할 수 있어 효율적인 리소스 관리와 비용 절감을 도모할 수 있음.
    - 이 두 가지 기능은 서로 보완적으로 작동하여, 트래픽이 증가하더라도 서비스의 성능을 유지하고, 서버 장애 시에도 서비스의 가용성을 보장하는데 중요한 역할을 함.
